# Although this mozconfig is used for TEST_PROCESSORTYPE=intel64, it actually
# creates a 32bit build which does not have crash-reporter support due to 
# limitations on the 1.9.2 branch. 1.9.2 builds should be produced on Mac 10.5
# machines.

CPU=`sysctl -a hw 2>&1 | grep 'hw.availcpu' | sed 's|hw.availcpu = *||'`
let J=$CPU+1
if [[ $J -gt 4 ]]; then let J=4; fi

mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/firefox-opt
mk_add_options MOZ_MAKE_FLAGS=-j${J}
mk_add_options MOZ_CO_PROJECT=browser
mk_add_options AUTOCONF=autoconf213

#ac_add_options --with-macos-sdk=/Developer/SDKs/MacOSX10.5.sdk

ac_add_options --enable-application=browser
ac_add_options --disable-debug
ac_add_options --enable-optimize
ac_add_options --enable-debug-symbols="-gdwarf-2"
# libxul required for packaging.
ac_add_options --enable-libxul
# do not strip symbols in packaged builds
ac_add_options --disable-install-strip

ac_add_options --enable-tests
#ac_add_options --enable-logrefcnt
ac_add_options --enable-accessibility


ac_add_options --disable-installer
ac_add_options --enable-official-branding

export CFLAGS="-gdwarf-2"
export CXXFLAGS="-gdwarf-2"

# For NSS symbols
export MOZ_DEBUG_SYMBOLS=1

# Needed to enable breakpad in application.ini
export MOZILLA_OFFICIAL=1

export CC="gcc-4.2 -arch i386"
export CXX="g++-4.2 -arch i386"
ac_add_options --target=i386-apple-darwin8.0.0
ac_add_options --enable-macos-target=10.5
# bug 491774. crashreporter won't build in cross compile
ac_add_options --disable-crashreporter

HOST_CC="gcc-4.2"
HOST_CXX="g++-4.2"
RANLIB=ranlib
AR=ar
AS=$CC
LD=ld
STRIP="strip -x -S"
CROSS_COMPILE=1
