{
 "views":{ 
   "site_test_crash":{
         "sql":"SELECT stc.url,
                       DATE_FORMAT(stc.datetime, '%Y-%m-%d %H:%i:%s') AS 'datetime',
                       stc.reason,
                       stc.address,
                       stc.crashreport,
                       stc.crashtype,
                       stc.pluginfilename,
                       stc.pluginversion,
                       stc.exploitability,
                       stc.testrun_id,
                       stc.crash_id,
                       c.signature
                FROM SiteTestCrash AS stc
                JOIN Crash AS c ON stc.crash_id = c.id
                WHERE REP0 
                ORDER BY stc.datetime DESC
                LIMIT 500",
         "host_type":"master_host"
      },
      "socorro_record":{
         "sql":"SELECT sr.id,
                       sr.signature,
                       sr.url,
                       sr.uuid,
                       sr.client_crash_date,
                       sr.date_processed,
                       sr.last_crash,
                       sr.product,
                       sr.version,
                       sr.build,
                       sr.branch,
                       sr.os_name,
                       sr.os_full_version,
                       sr.os_version,
                       sr.cpu_info,
                       sr.cpu_name,
                       sr.address,
                       sr.bug_list,
                       sr.user_comments,
                       sr.reason,
                       DATE_FORMAT(str.datetime, '%Y-%m-%d %H:%i:%s') AS 'datetime',
                FROM SocorroRecord AS sr, SiteTestRun AS str
                WHERE sr.id = str.socorro_id
                REP0
                ORDER BY str.datetime DESC
                LIMIT 500",
         "host_type":"master_host"
      },
      "crashes":{

            "sql":"SELECT Crash.signature, 
                          fatal_message, 
                          SiteTestRun.branch, 
                          SiteTestRun.os_name, 
                          SiteTestRun.os_version, 
                          SiteTestRun.cpu_name, 
                          count( Crash.id ) AS 'count',
                          SocorroRecord.url
                  FROM SocorroRecord, Crash, SiteTestCrash, SiteTestRun
                  WHERE Crash.id = SiteTestCrash.crash_id
                  AND SiteTestRun.id = SiteTestCrash.testrun_id
                  AND SocorroRecord.id = SiteTestRun.socorro_id
                  REP0
                  GROUP BY Crash.signature, 
                           fatal_message, 
                           SiteTestRun.branch, 
                           SiteTestRun.os_name, 
                           SiteTestRun.os_version, 
                           SiteTestRun.cpu_name
                  LIMIT 500",

            "host_type":"master_host"
      },

      "newcrashes":{

            "sql":"SELECT Crash.signature, 
                          fatal_message, 
                          SiteTestRun.branch, 
                          SiteTestRun.os_name, 
                          SiteTestRun.os_version, 
                          SiteTestRun.cpu_name, 
                          DATE_FORMAT(SiteTestRun.datetime, '%Y-%m-%d %H:%i:%s') AS 'datetime',
                          count( Crash.id ) AS 'count'
                  FROM SocorroRecord, Crash, SiteTestCrash, SiteTestRun
                  WHERE Crash.id = SiteTestCrash.crash_id
                  AND SiteTestRun.id = SiteTestCrash.testrun_id
                  AND SocorroRecord.id = SiteTestRun.socorro_id
                  REP0
                  AND Crash.id NOT
                  IN ( SELECT Crash.id
                       FROM Crash, SiteTestCrash
                       WHERE Crash.id = SiteTestCrash.crash_id
                       AND SiteTestRun.datetime < REP1)
                  GROUP BY Crash.signature, 
                           fatal_message, 
                           SiteTestRun.branch, 
                           SiteTestRun.os_name, 
                           SiteTestRun.os_version, 
                           SiteTestRun.cpu_name
                  ORDER BY `SiteTestRun`.`datetime`
                  LIMIT 500",

            "host_type":"master_host"
      },

      "tempurls":{
         "sql":"CREATE TEMPORARY TABLE IF NOT EXISTS temp_urls_s AS SELECT DISTINCT SiteTestCrash.url as url
                FROM Crash, SiteTestCrash
                WHERE Crash.id = SiteTestCrash.crash_id
                REP0",

         "host_type":"master_host"
      },
      "urls":{
         "sql":"SELECT SiteTestCrash.url,
                       Crash.branch,
                       Crash.os_name,
                       Crash.os_version,
                       Crash.build_cpu_name,
                       Crash.signature,
                       DATE_FORMAT(SiteTestCrash.datetime, '%Y-%m-%d %H:%i:%s') AS 'datetime',
                       Count(*) AS 'count'
               FROM Crash, SiteTestCrash
               WHERE Crash.id = SiteTestCrash.crash_id
               REP0
               AND SiteTestCrash.url IN (SELECT url FROM temp_urls_s)
               GROUP BY SiteTestCrash.url, Crash.branch, Crash.os_name, Crash.os_version, Crash.build_cpu_name
               ORDER BY SiteTestCrash.datetime DESC
               LIMIT 500",

         "host_type":"master_host"
      },

      "crashdetail":{

         "sql":"SELECT c.signature AS signature, 
                       c.os_name, 
                       c.os_version, 
                       c.cpu_name, 
                       c.product, 
                       c.branch, 
                       c.buildtype, 
                       c.build_cpu_name, 
                       stc.url, 
                       DATE_FORMAT(stc.datetime, '%Y-%m-%d %H:%i:%s') AS 'datetime',
                       stc.reason, 
                       stc.address, 
                       stc.crashreport, 
                       stc.crashtype, 
                       stc.pluginfilename, 
                       stc.pluginversion, 
                       stc.exploitability,
                       str.changeset, 
                       str.bug_list, 
                       str.steps, 
                       str.fatal_message AS fatal_message, 
                       str.exitstatus, 
                       str.log, 
                       str.priority, 
                       sr.signature, 
                       sr.url AS url, 
                       sr.uuid,   
                       sr.bug_list, 
                       sr.user_comments, 
                       sr.flash_version, 
                       sr.hangid, 
                       sr.reason, 
                       sr.process_type, 
                       sr.app_notes 
               FROM Crash AS c
               JOIN SiteTestCrash AS stc ON c.id = stc.crash_id
               JOIN SiteTestRun AS str ON stc.testrun_id = str.id
               JOIN SocorroRecord AS sr ON str.socorro_id = sr.id
               WHERE stc.url IN (
                  SELECT DISTINCT stc.url AS url
                  FROM Crash AS c
                  JOIN SiteTestCrash AS stc
                  ON c.id = stc.crash_id 
                  REP0 ) 
               REP1
               LIMIT 500",

         "host_type":"master_host"
      },

      "tempurls_fm":{
         "sql":"CREATE TEMPORARY TABLE IF NOT EXISTS temp_urls_fm AS SELECT DISTINCT SiteTestCrash.url as url
                FROM Crash, SiteTestCrash, SiteTestRun
                WHERE Crash.id = SiteTestCrash.crash_id
                AND SiteTestCrash.testrun_id = SiteTestRun.id
                REP0",

         "host_type":"master_host"
      },

      "urls_fm":{
         "sql":"SELECT SiteTestCrash.url,
                       Crash.branch,
                       Crash.os_name,
                       Crash.os_version,
                       Crash.build_cpu_name,
                       Crash.signature,
                       Count(*) AS 'count'
               FROM Crash, SiteTestCrash
               WHERE Crash.id = SiteTestCrash.crash_id
               REP0
               AND SiteTestCrash.url IN (SELECT url FROM temp_urls_fm)
               GROUP BY SiteTestCrash.url, Crash.branch, Crash.os_name, Crash.os_version, Crash.build_cpu_name
               LIMIT 500",

         "host_type":"master_host"
      }
   }
}

